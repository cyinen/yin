<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1、设计目的设计一个电梯控制系统，能够实现电梯的自动运行、显示楼层，轿内外呼叫，多电梯智能运行。 2、设计任务1.电梯能够正常上升下行 2.液晶正常示楼层状态 P:静止 ^：上升 v：静止 3.实现轿内外呼叫 4.双电梯并联运行，根据呼叫楼层白动运行 5.电梯长时间无人乘坐时到指定楼层等待 6.电梯故障时可以示警。 7.步进电梯模拟电梯运行。">
<meta property="og:type" content="article">
<meta property="og:title" content="电梯控制系统">
<meta property="og:url" content="https://github.com/2021/07/25/dian-ti-kong-zhi-xi-tong/index.html">
<meta property="og:site_name" content="陈小银的博客">
<meta property="og:description" content="1、设计目的设计一个电梯控制系统，能够实现电梯的自动运行、显示楼层，轿内外呼叫，多电梯智能运行。 2、设计任务1.电梯能够正常上升下行 2.液晶正常示楼层状态 P:静止 ^：上升 v：静止 3.实现轿内外呼叫 4.双电梯并联运行，根据呼叫楼层白动运行 5.电梯长时间无人乘坐时到指定楼层等待 6.电梯故障时可以示警。 7.步进电梯模拟电梯运行。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image9.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image2.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/55.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image4.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/77.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/imaggge6.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image7.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image8.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image9.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image10.png">
<meta property="og:image" content="https://github.com/2021/07/25/dian-ti-kong-zhi-xi-tong/media/image11.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image12.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image14.png">
<meta property="article:published_time" content="2021-07-25T05:21:38.452Z">
<meta property="article:modified_time" content="2021-07-25T05:22:47.252Z">
<meta property="article:author" content="Chen Yin">
<meta property="article:tag" content="单片机 C 电梯控制">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image9.png">

<link rel="canonical" href="https://github.com/2021/07/25/dian-ti-kong-zhi-xi-tong/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>电梯控制系统 | 陈小银的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="陈小银的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">陈小银的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/2021/07/25/dian-ti-kong-zhi-xi-tong/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/R.png">
      <meta itemprop="name" content="Chen Yin">
      <meta itemprop="description" content="卑鄙是卑鄙者的通行证，高尚是高尚者的墓志铭">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陈小银的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          电梯控制系统
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-07-25 13:21:38 / 修改时间：13:22:47" itemprop="dateCreated datePublished" datetime="2021-07-25T13:21:38+08:00">2021-07-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%BE%E8%AE%BE%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">课设设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1、设计目的"><a href="#1、设计目的" class="headerlink" title="1、设计目的"></a>1、设计目的</h2><p>设计一个电梯控制系统，能够实现电梯的自动运行、显示楼层，轿内外呼叫，多电梯智能运行。</p>
<h2 id="2、设计任务"><a href="#2、设计任务" class="headerlink" title="2、设计任务"></a>2、设计任务</h2><p>1.电梯能够正常上升下行</p>
<p>2.液晶正常示楼层状态 P:静止 ^：上升 v：静止</p>
<p>3.实现轿内外呼叫</p>
<p>4.双电梯并联运行，根据呼叫楼层白动运行</p>
<p>5.电梯长时间无人乘坐时到指定楼层等待</p>
<p>6.电梯故障时可以示警。</p>
<p>7.步进电梯模拟电梯运行。</p>
<span id="more"></span>
<h2 id="3、原理框图及说明"><a href="#3、原理框图及说明" class="headerlink" title="3、原理框图及说明"></a>3、原理框图及说明</h2><p>根据设计任务，设计如下框图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image9.png" alt="5555"></p>
<p>图1、原理框图</p>
<p>电源部分，为单片机提供5V稳压电源；红安按键提供给用户用来选择楼层；LCD用来显示电梯运行楼层和所在楼层；LED在电梯发生故障时闪烁；蜂鸣器在电梯到达目标楼层后发出声音。</p>
<p>51上电后，显示电梯当前状态和所在楼层；等待案件按下后执行相应的操作。</p>
<p>根据原理框图，设计电路图如附件1</p>
<h2 id="4、主要电路说明、元件选择及参数计算"><a href="#4、主要电路说明、元件选择及参数计算" class="headerlink" title="4、主要电路说明、元件选择及参数计算"></a>4、主要电路说明、元件选择及参数计算</h2><h3 id="4-1-单片机最小系统模块"><a href="#4-1-单片机最小系统模块" class="headerlink" title="4.1 单片机最小系统模块"></a>4.1 单片机最小系统模块</h3><p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image2.png">{width=”3.0833333333333335in”<br>height=”2.910416666666667in”}</p>
<p>图3、最小系统模块</p>
<p>单片机最小系统包括主芯片，复位电路和晶振脉冲产生电路X1为12MHz晶振，与30Pf电容并联，产生1us地脉神信号作为单片机地”心脏”部分.复位电路是开关与10uf电容并联组成地上电自动复位电路，在RST端为高电平时单片机清零，也即开关按下会产生清零信号RP1为排阻，作为po端地上拉电阻，接此原因是po端口是由oC门组成U1为数据输入端口，通过电脑编程能将程序通过此接口烧录入单片机中</p>
<h3 id="4-2按键电路"><a href="#4-2按键电路" class="headerlink" title="4.2按键电路"></a>4.2按键电路</h3><p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/55.png" alt="55"></p>
<p>图4、红外按键电路</p>
<p>当有按键按下时自动申请中断、判断按键。</p>
<h3 id="4-3-电机驱动电路"><a href="#4-3-电机驱动电路" class="headerlink" title="4.3 电机驱动电路"></a>4.3 电机驱动电路</h3><p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image4.png">{width=”2.602777777777778in”<br>height=”1.7881944444444444in”}</p>
<p>图5、电机驱动电路</p>
<p>电机驱动采用L297环形计数分配器和L298大功率步进电机驱动器完成.本次设计采用步进电机，目地是方便智能控制，可实现调速功能.电机使用地是四相步进电机，由于仅用来实验，所以电机采用5V电源供电即可，实际中必须使用大电压来供电方能带动重物（人等）.</p>
<h3 id="4-4-显示模块"><a href="#4-4-显示模块" class="headerlink" title="4.4 显示模块"></a>4.4 显示模块</h3><p>采用LCD1602作为显示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/77.png" alt="77"></p>
<p>图6、显示电路</p>
<h3 id="4-5-报警模块"><a href="#4-5-报警模块" class="headerlink" title="4.5 报警模块"></a>4.5 报警模块</h3><p>在电梯到达目标楼层后发出声音提醒乘客、也能在电梯故障时发出警报。</p>
<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/imaggge6.png" alt="imaggge6"></p>
<p>图7、报警电路</p>
<h2 id="5、总电路设计"><a href="#5、总电路设计" class="headerlink" title="5、总电路设计"></a>5、总电路设计</h2><p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image7.png">{width=”2.654166666666667in”<br>height=”2.813888888888889in”}</p>
<p>图8、总电路设计图</p>
<p>实物连接图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image8.png">{width=”3.2402777777777776in”<br>height=”1.8416666666666666in”}</p>
<p>图9、实物连接图</p>
<h2 id="6、软件设计思路及框图"><a href="#6、软件设计思路及框图" class="headerlink" title="6、软件设计思路及框图"></a>6、软件设计思路及框图</h2><h3 id="6-1软件设计思路及主流程图"><a href="#6-1软件设计思路及主流程图" class="headerlink" title="6.1软件设计思路及主流程图"></a>6.1软件设计思路及主流程图</h3><p>根据设计方案、单片机上电以后初始化电梯状态、在LCD1602上显示。接着根据是否有人选择楼梯去执行相应的方案。</p>
<p>Main函数是入口函数、一直循环：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

P0<span class="token operator">=</span><span class="token number">0X00</span><span class="token punctuation">;</span>

dula<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

wela<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">delay1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dula<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

wela<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">delay1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">ecternINT0Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">timerInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">LCDInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span> <span class="token comment">//初始化各行为低电压</span>

<span class="token comment">//zhenzhuan();</span>

EA <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

row1<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>row2<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>row3<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>row4<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

col1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>col2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>col3<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>col4<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>lastvaule<span class="token operator">!=</span>EleOne \<span class="token operator">|</span>\<span class="token operator">|</span> lastvaule2<span class="token operator">!=</span>EleTwo<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

beep<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

lastvaule<span class="token operator">=</span>EleOne<span class="token punctuation">;</span>

lastvaule2<span class="token operator">=</span>EleTwo<span class="token punctuation">;</span>

<span class="token function">delayxms</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

beep<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>keyVauleFlag<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

keyVauleFlag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">keyProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>keyFlag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

keyFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">keyProcess2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token function">LookAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>LCD<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

<span class="token function">LCD1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

LCD<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>receiveFlag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

receiveFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">dataProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>processFlag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

processFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">keyValueProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>time1<span class="token operator">==</span><span class="token number">140</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span> time1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token function">initEL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image9.png">{width=”3.7118055555555554in” height=”3.49375in”}</p>
<p>图10、软件主要运行流程图</p>
<p>电梯调度算法是整个算法的核心、下面我用一个电梯举例、按照以下规则运行实现：</p>
<blockquote>
<p>1.处于上升状态时只处理向上的请求，处于向下状态时只处理向下的请求</p>
<p>2.当有多个向上请求时，先下降到请求调度的最底层再响应向上请求；当有多个向下请求时，先上升到请求调度的最高层再响应向下请求由于只考虑单电梯调度算法，所以电梯<br>1 和电梯 2 的调度算法完全相同，下面我们以电梯 1<br>的调度算法为例进行解释：当电梯处于静止状态时处理的流程图如下：</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image10.png">{width=”4.333333333333333in”<br>height=”2.9229166666666666in”}</p>
<p>图11、电梯静止状态下执行流程</p>
<p>当电梯处于向上运动状态时，处理的流程图如下：</p>
<p><img src="media/image11.png">{width=”4.307638888888889in” height=”3.0125in”}</p>
<p>图12、电梯上行是的执行流程</p>
<blockquote>
<p>其中第一个分支遵循”向上状态只响应向上请求”原则，这种向上请求分为：</p>
<p>1.电梯内部有人向上；</p>
<p>2.高楼层有人按下向上按钮。</p>
</blockquote>
<p>在这两种状态下电梯仍然需要保持向上状态；如果这两种状态不存在也就意味着电梯不需要再向上了，可以转换方向了；第二个分支遵循”如果有多个楼层请求向下则先上升到最高楼层再向下”，如果高楼层有人请求向下我们仍然需要保持向上状态，但是这时的向上是为了到达请求向下楼层中的最高层，上升的原因改变了。如果高楼层没有向下请求，我们就查看是否低楼层有相关请求，如果有就让电梯向下，如果没有就将电梯置为静止状态。</p>
<p>当电梯处于向下状态的时，处理的流程图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image12.png">{width=”3.4166666666666665in”<br>height=”2.4291666666666667in”}</p>
<p>图13、电梯下行时执行流程图</p>
<p>电梯处于向下状态时处理流程和向上处理流程类似，遵循的原则也相似，在这里不在赘述。</p>
<p>实现代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">

<span class="token keyword">void</span> <span class="token function">LookAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

<span class="token comment">//处理e1</span>

<span class="token comment">//处理e1</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleOneState<span class="token operator">==</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//静止</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>callfloor<span class="token operator">></span>EleOne<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleOneState<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

EleOne<span class="token operator">++</span><span class="token punctuation">;</span>

<span class="token function">zhenzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>callfloor\<span class="token operator">&lt;</span>EleOne <span class="token operator">&amp;&amp;</span> callfloor<span class="token operator">>=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleOneState<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>

EleOne\<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token function">fanzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleOneState<span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>upfloor<span class="token operator">></span>EleOne<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleOne<span class="token operator">++</span><span class="token punctuation">;</span>

<span class="token function">zhenzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleOne<span class="token operator">==</span>upfloor <span class="token operator">&amp;&amp;</span> downfloor\<span class="token operator">&lt;</span><span class="token number">4</span> <span class="token operator">&amp;&amp;</span> downfloor<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

upfloor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

EleOneState<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>

EleOne\<span class="token operator">--</span><span class="token punctuation">;</span><span class="token function">fanzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token punctuation">&#123;</span>

callfloor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

upfloor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

downfloor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

EleOneState<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleOneState<span class="token operator">==</span><span class="token number">2</span> <span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>downfloor\<span class="token operator">&lt;</span>EleOne<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleOne\<span class="token operator">--</span><span class="token punctuation">;</span><span class="token function">fanzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleOne<span class="token operator">==</span>downfloor <span class="token operator">&amp;&amp;</span> upfloor<span class="token operator">></span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> upfloor\<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

downfloor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

EleOneState<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

EleOne<span class="token operator">++</span><span class="token punctuation">;</span>

<span class="token function">zhenzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span><span class="token punctuation">&#123;</span>

callfloor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

upfloor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

downfloor<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

EleOneState<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token comment">//处理e2</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleTwoState<span class="token operator">==</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//静止</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>callfloor2<span class="token operator">></span>EleTwo<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleTwoState<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

EleTwo<span class="token operator">++</span><span class="token punctuation">;</span>

<span class="token function">zhenzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>callfloor2\<span class="token operator">&lt;</span>EleTwo <span class="token operator">&amp;&amp;</span> callfloor2<span class="token operator">>=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleTwoState<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>

EleTwo\<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token function">fanzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleTwoState<span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>upfloor2<span class="token operator">></span>EleTwo<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleTwo<span class="token operator">++</span><span class="token punctuation">;</span>

<span class="token function">zhenzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleTwo<span class="token operator">==</span>upfloor2 <span class="token operator">&amp;&amp;</span> downfloor2\<span class="token operator">&lt;</span><span class="token number">4</span> <span class="token operator">&amp;&amp;</span> downfloor2<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

upfloor2<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

EleTwoState<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>

EleTwo\<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token function">fanzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token punctuation">&#123;</span>

callfloor2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

upfloor2<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

downfloor2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

EleTwoState<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleTwoState<span class="token operator">==</span><span class="token number">2</span> <span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>downfloor2\<span class="token operator">&lt;</span>EleTwo<span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

EleTwo\<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token function">fanzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>EleTwo<span class="token operator">==</span>downfloor2 <span class="token operator">&amp;&amp;</span> upfloor2<span class="token operator">></span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> upfloor2\<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token punctuation">&#123;</span>

downfloor2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

EleTwoState<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

EleTwo<span class="token operator">++</span><span class="token punctuation">;</span>

<span class="token function">zhenzhuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">else</span><span class="token punctuation">&#123;</span>

callfloor2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

upfloor2<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

downfloor2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

EleTwoState<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token comment">//delayxms(500);</span>

<span class="token punctuation">&#125;</span>

### <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-2参数计算"><a href="#6-2参数计算" class="headerlink" title="6.2参数计算"></a>6.2参数计算</h3><p>在步进电梯的运行过程中，需要精确的时间控制。我的晶振是 11.0592M，时</p>
<p>钟周期就是 1/11059200，机器周期是 12/11059200，假如要定时 20ms，就是<br>0.02 秒，要经过 x 个机器周期得到 0.02 秒，我们来算一下<br>x*12/11059200=0.02，得到 x= 18432。16 位定时器的溢出值是 65536（因<br>65535 再加 1 才是溢出），于是我们就可以这样操作，先给 TH0 和<br>TL0一个初始值，让它们经过 18432个机器周期后刚好达到<br>65536，也就是溢出，溢出后可以通 过检测 TF0 的值得知，就刚好是 0.02<br>秒。那么初值 y = 65536 - 18432 = 47104，转成 16 进制 就是 0xB800，也就是<br>TH0 = 0xB8，TL0 = 0x00。如果初值直接给一个 0x0000，</p>
<p>一直到 65536 溢出，定时器定时值最大也就是 71ms<br>左右。为了单片机在无人使用时、能够在10秒钟以后回到指定位置，我们得到设置参数n=10s/71ms=143。</p>
<h2 id="7、结果及测试分析"><a href="#7、结果及测试分析" class="headerlink" title="7、结果及测试分析"></a>7、结果及测试分析</h2><h3 id="7-1硬件电路"><a href="#7-1硬件电路" class="headerlink" title="7.1硬件电路"></a>7.1硬件电路</h3><p>图14、实物图</p>
<p>为了不让电机的接口与其他接口冲突，将电机从P0接到P2口。</p>
<p>图15、电梯接线图</p>
<h3 id="7-2测试记录及结果分析"><a href="#7-2测试记录及结果分析" class="headerlink" title="7.2测试记录及结果分析"></a>7.2测试记录及结果分析</h3><p>制作完成后，进行如下测试，结果合格。</p>
<hr>
<p>  功能要求                      功能描述                  测试结果</p>
<p>  （1）按键是否满足设计的功能   按下4楼                   电梯上升、电机转动、自动更新显示，正常</p>
<pre><code>                            按下1                     电梯下降到达1楼
</code></pre>
<p>  （2）两电梯能否并联运行       电梯在轿外呼叫2楼         离呼叫楼层最近的电梯运行</p>
<p>  （3）报警功能是否正常         按下报警按钮              LED开始闪烁，蜂鸣器开始鸣响</p>
<p>  （4）能否自动回到指定楼层     不进行任何操作            10秒钟后，电梯自动回到指定楼层</p>
<hr>
<p>经过以上的测试和分析，经实现了以下的所有功能</p>
<blockquote>
<p>1.电梯能够正常上升下行</p>
<p>2.液晶正常示楼层状态 P:静止 ^：上升 v：静止</p>
<p>3.实现轿内外呼叫</p>
<p>4.双电梯并联运行，根据呼叫楼层白动运行</p>
<p>5.电梯长时间无人乘坐时到指定楼层等待</p>
<p>6.电梯故障时可以示警。</p>
<p>7.步进电梯模拟电梯运行。</p>
</blockquote>
<h2 id="8、体会与感想"><a href="#8、体会与感想" class="headerlink" title="8、体会与感想"></a>8、体会与感想</h2><p>在整个电梯系统的设计过程中，我遇到了下面的几个问题，最终都通过自己的努力解决了。</p>
<p>问题1：数码管显示不稳定、具有较为明显的闪烁现象。这是由于数码管显示采用动态扫描的方法，当间隔时间过长、在人眼中就会出现闪烁现象。解决思路：采用定时器来定时、每个30ms数码管显示一下。</p>
<p>问题2：矩阵键盘采用扫描法来扫描按键时、程序运行的时候不能够识别按键。解决思路：使用外部中断、当有按键按下时申请中断。</p>
<p>问题3：两路外部中断只能识别8个按键、对于两部电梯完全不够用。解决思路：弃用矩阵键盘、改用红外遥控键盘</p>
<p>问题4：两部电梯不能够协同工作、只能各自独立运行。解决思路：改进电梯调度算法</p>
<p>问题5：步进电机一直震动，但是不能转动。发现是一次只给了4个脉冲，不能转动。</p>
<p>通过这次单片机地实践，我感觉我地理论知识和实践能力都有了很显著地提高，比如说再写程序地时候遇到了一些问题，或者是说写地程序运行不了，我就会查找大量地资料来解决这些问题，用一些更合适地指令来实现课题要求地功能.从写程序到焊接电路，到调试电路，我付出了很大地努力.同时自己也更深入地了解到了单片机地无穷魅力，我现在对我们地专业更加地热爱了，因为我在实践中能体会到很大地乐趣，虽然有地时候可能遇到了一些困难，但是我最终解决了，或者是说在同学地帮助下解决了，我也会感觉到成功给我带来地喜悦，这种喜悦是其他人难以想象地到地，但是，我知道我不能骄傲，我知道我在专业知识上地掌握还是远远不够地，我还要更加努力地去学习，充实自己地理论知识，提高自己了实践能力.</p>
<p>附1、原理图</p>
<p><img src="https://cdn.jsdelivr.net/gh/cyinen/imge@master/img/image14.png">{width=”5.769444444444445in”<br>height=”6.121527777777778in”}</p>
<p>附2、程序清单</p>
<p>main.c</p>
<p>#include &quot;InfraredControl2.h&quot;</p>
<p>sbit beep=P2^3;</p>
<p>bit keyVauleFlag =0;</p>
<p>sbit p3_2=P3^2;</p>
<p>sbit p3_3=P3^3;</p>
<p>//声明各个端口</p>
<p>sbit row1=P3^0;</p>
<p>sbit row2=P3^1;</p>
<p>sbit row3=P3^2;</p>
<p>sbit row4=P3^3;</p>
<p>sbit col1=P3^4;</p>
<p>sbit col2=P3^5;</p>
<p>sbit col3=P3^6;</p>
<p>sbit col4=P3^7;</p>
<p>//EleOne 表示电梯1现在处于的楼层，EleTwo表示现在电梯2处于的楼层</p>
<p>//EleOneState表示电梯1所处的状态，其中0静止，1向上，2向下</p>
<p>//EleTwoState表示电梯2所处的状态，数字的含义和EleOneState完全相同</p>
<p>uchar callfloor;</p>
<p>uchar upfloor;</p>
<p>uchar downfloor;</p>
<p>uchar callfloor2;</p>
<p>uchar upfloor2;</p>
<p>uchar downfloor2;</p>
<p>uchar EleOneState=0;</p>
<p>uchar EleTwoState=0;</p>
<p>unsigned char i,j,k,temp,key;</p>
<p>uchar EleOne=1;</p>
<p>uchar EleTwo=4;</p>
<p>uchar lastvaule;</p>
<p>uchar lastvaule2;</p>
<p>/*定义全局变量*/</p>
<p>uchar time = 0; // 用于记录接收的数据中两个下降沿之间的时间差</p>
<p>uchar time1 = 0;</p>
<p>uchar disValue = 0; // 用于存放要显示数据</p>
<p>uchar dat[DATALEN] = 0; // 用于存放接收到的数据</p>
<p>uchar finalData[4] = 0; // 用于存放最终译码后的键值</p>
<p>bit receiveFlag = 0; // 接收结束标志位</p>
<p>bit processFlag = 0; // 一帧数据处理完成标志位</p>
<p>bit keyFlag = 0; // 键值处理完成标志位</p>
<p>bit rFlag=0;</p>
<p>bit LCD=0;</p>
<p>void delay(unsigned char i)</p>
<p>{</p>
<p>for (j=i;j&gt;0;j--)</p>
<p>for(k=125;k&gt;0;k--);</p>
<p>}</p>
<p>//显示的字符数组</p>
<p>unsigned char code DispCode[]=</p>
<p>{</p>
<p>0xc0,0xF9,0xA4,0xB0,0x99, //0-4</p>
<p>0x92,0x82,0xF8,0x80,0x90, //5-9</p>
<p>0x88,0x83,0xC6,0xA1,0x86, //A,b,C,d,E,F</p>
<p>0x8E</p>
<p>};</p>
<p>/*定时器初始化函数*/</p>
<p>void timerInit(){</p>
<p>/* TMOD = 0x02; // timer0 定时模式 工作方式2(自动重装初值的8位定时器)</p>
<p>TH0 = 0x00; // 置初值</p>
<p>TL0 = 0x00;</p>
<p>ET0 = 1; // 开timer0溢出中断</p>
<p>TR0 = 1; // 启动timer0 */</p>
<p>TMOD=0x12;</p>
<p>TH0 = 0x00; // 置初值</p>
<p>TL0 = 0x00;</p>
<p>TH1=0x00;</p>
<p>TL1=0x00;</p>
<p>ET0=1;</p>
<p>ET1=1;</p>
<p>TR0=1;</p>
<p>TR1=1;</p>
<p>}</p>
<p>/*timer0中断服务程序*/</p>
<p>void timer0Service() interrupt 1{</p>
<p>time++;</p>
<p>}</p>
<p>/*timer1中断服务程序*/</p>
<p>void timer1Service() interrupt 3{</p>
<p>TH1=0x00;</p>
<p>TL1=0x00;</p>
<p>if(EleOneState==0 &amp;&amp; EleTwoState==0 )</p>
<p>time1++;</p>
<p>}</p>
<p>void delay1 (void)//关闭数码管延时程序</p>
<p>{</p>
<p>int k;</p>
<p>for (k=0; k&lt;1000; k++);</p>
<p>}</p>
<p>void LCD1()</p>
<p>{ int i=20;</p>
<p>while(i){</p>
<p>P1=~P1;beep=~beep;</p>
<p>delayxms(500);</p>
<p>i--;}</p>
<p>}</p>
<p>void initEL()</p>
<p>{</p>
<p>while(EleOne!=1)</p>
<p>{ EleOne--;</p>
<p>fanzhuan();display();}</p>
<p>while(EleTwo!=4)</p>
<p>{ EleTwo++;</p>
<p>zhenzhuan();display();}</p>
<p>}</p>
<p>void main()</p>
<p>{</p>
<p>P0=0X00;</p>
<p>dula=1;</p>
<p>wela=0;</p>
<p>delay1();</p>
<p>dula=0;</p>
<p>wela=0;</p>
<p>delay1();</p>
<p>ecternINT0Init();</p>
<p>timerInit();</p>
<p>LCDInit();</p>
<p>while(1)</p>
<p>{ //初始化各行为低电压</p>
<p>//zhenzhuan();</p>
<p>EA =1;</p>
<p>row1=1;row2=1;row3=1;row4=1;</p>
<p>col1=0;col2=0;col3=0;col4=0;</p>
<p>if(lastvaule!=EleOne || lastvaule2!=EleTwo)</p>
<p>{</p>
<p>beep=0;</p>
<p>display();</p>
<p>lastvaule=EleOne;</p>
<p>lastvaule2=EleTwo;</p>
<p>delayxms(400);</p>
<p>beep=1;</p>
<p>}</p>
<p>display();</p>
<p>if(keyVauleFlag)</p>
<p>{</p>
<p>keyVauleFlag=0;</p>
<p>keyProcess();</p>
<p>}</p>
<p>if(keyFlag){</p>
<p>keyFlag = 0;</p>
<p>keyProcess2();</p>
<p>}</p>
<p>LookAlgorithm();</p>
<p>if(LCD)</p>
<p>{</p>
<p>LCD1();</p>
<p>LCD=0;}</p>
<p>if(receiveFlag){</p>
<p>receiveFlag = 0;</p>
<p>dataProcess();</p>
<p>}</p>
<p>if(processFlag){</p>
<p>processFlag = 0;</p>
<p>keyValueProcess();</p>
<p>}</p>
<p>if(time1==140)</p>
<p>{ time1=0;</p>
<p>initEL();</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>/*外部中断0(INT0),1初始化*/</p>
<p>void ecternINT0Init(){</p>
<p>IT0 = 1; //外部中断0为跳变沿触发</p>
<p>EX0 = 1; // 允许外部中断0</p>
<p>IT1 = 1;</p>
<p>EX1 = 1;</p>
<p>EA = 1; // 开全局中断</p>
<p>}</p>
<p>/*外部中断0(INT0)中断服务程序*/</p>
<p>void externINT0Service() interrupt 0{</p>
<p>static uchar i; // 定义静态局部变量i, 每次调用函数时保存上次的变量值</p>
<p>static bit startFlag;</p>
<p>if(startFlag){ // 判定是否已启动红外通信</p>
<p>if(time &gt;= 30 &amp;&amp; time &lt; 50){ // 检测到引导码(4.5 + 4.5 = 9ms), 9 /<br>0.278 = 32; 检测冗余时间范围[30, 50]</p>
<p>i = 0; // 引导码保存在数组的第0位</p>
<p>}</p>
<p>dat[i++] = time; // 存储每个数据位持续的时间用于后续0 1的判定</p>
<p>time = 0;</p>
<p>if(i == 33){ // 一帧数据(1bit引导码 + 32bit数据)接收结束</p>
<p>receiveFlag = 1;</p>
<p>i = 0;</p>
<p>}</p>
<p>}else{ // 启动红外通信</p>
<p>time = 0;</p>
<p>startFlag = 1;</p>
<p>}</p>
<p>}</p>
<p>void LookAlgorithm()</p>
<p>{</p>
<p>//处理e1</p>
<p>//处理e1</p>
<p>if(EleOneState==0 ){ //静止</p>
<p>if(callfloor&gt;EleOne)</p>
<p>{</p>
<p>EleOneState=1;</p>
<p>EleOne++;</p>
<p>zhenzhuan();</p>
<p>}</p>
<p>else</p>
<p>if(callfloor&lt;EleOne &amp;&amp; callfloor&gt;=1)</p>
<p>{</p>
<p>EleOneState=2;</p>
<p>EleOne--; fanzhuan();</p>
<p>}</p>
<p>}else</p>
<p>if(EleOneState==1 ){</p>
<p>if(upfloor&gt;EleOne)</p>
<p>{</p>
<p>EleOne++;</p>
<p>zhenzhuan();</p>
<p>}</p>
<p>else</p>
<p>if(EleOne==upfloor &amp;&amp; downfloor&lt;4 &amp;&amp; downfloor&gt;0)</p>
<p>{</p>
<p>upfloor=1;</p>
<p>EleOneState=2;</p>
<p>EleOne--;fanzhuan();</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>callfloor=0;</p>
<p>upfloor=1;</p>
<p>downfloor=0;</p>
<p>EleOneState=0;</p>
<p>}</p>
<p>}else</p>
<p>if(EleOneState==2 )</p>
<p>{</p>
<p>if(downfloor&lt;EleOne)</p>
<p>{</p>
<p>EleOne--;fanzhuan();</p>
<p>}</p>
<p>else</p>
<p>if(EleOne==downfloor &amp;&amp; upfloor&gt;1 &amp;&amp; upfloor&lt;5)</p>
<p>{</p>
<p>downfloor=0;</p>
<p>EleOneState=1;</p>
<p>EleOne++;</p>
<p>zhenzhuan();</p>
<p>}</p>
<p>else{</p>
<p>callfloor=0;</p>
<p>upfloor=1;</p>
<p>downfloor=0;</p>
<p>EleOneState=0;</p>
<p>}</p>
<p>}</p>
<p>//处理e2</p>
<p>if(EleTwoState==0 ){ //静止</p>
<p>if(callfloor2&gt;EleTwo)</p>
<p>{</p>
<p>EleTwoState=1;</p>
<p>EleTwo++;</p>
<p>zhenzhuan();</p>
<p>}</p>
<p>else</p>
<p>if(callfloor2&lt;EleTwo &amp;&amp; callfloor2&gt;=1)</p>
<p>{</p>
<p>EleTwoState=2;</p>
<p>EleTwo--; fanzhuan();</p>
<p>}</p>
<p>}else</p>
<p>if(EleTwoState==1 ){</p>
<p>if(upfloor2&gt;EleTwo)</p>
<p>{</p>
<p>EleTwo++;</p>
<p>zhenzhuan();</p>
<p>}</p>
<p>else</p>
<p>if(EleTwo==upfloor2 &amp;&amp; downfloor2&lt;4 &amp;&amp; downfloor2&gt;0)</p>
<p>{</p>
<p>upfloor2=1;</p>
<p>EleTwoState=2;</p>
<p>EleTwo--; fanzhuan();</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>callfloor2=0;</p>
<p>upfloor2=1;</p>
<p>downfloor2=0;</p>
<p>EleTwoState=0;</p>
<p>}</p>
<p>}else</p>
<p>if(EleTwoState==2 )</p>
<p>{</p>
<p>if(downfloor2&lt;EleTwo)</p>
<p>{</p>
<p>EleTwo--; fanzhuan();</p>
<p>}</p>
<p>else</p>
<p>if(EleTwo==downfloor2 &amp;&amp; upfloor2&gt;1 &amp;&amp; upfloor2&lt;5)</p>
<p>{</p>
<p>downfloor2=0;</p>
<p>EleTwoState=1;</p>
<p>EleTwo++;</p>
<p>zhenzhuan();</p>
<p>}</p>
<p>else{</p>
<p>callfloor2=0;</p>
<p>upfloor2=1;</p>
<p>downfloor2=0;</p>
<p>EleTwoState=0;</p>
<p>}</p>
<p>}</p>
<p>//delayxms(500);</p>
<p>}</p>
<p>int abs(int n) {</p>
<p>return n&lt;0 ? -n : n;</p>
<p>}</p>
<p>void keyProcess()</p>
<p>{</p>
<p>if(key&gt;=12 &amp;&amp; key&lt;=15)</p>
<p>{</p>
<p>key=key-11;</p>
<p>if(EleOneState==1)</p>
<p>{</p>
<p>upfloor = key &gt; upfloor ? key:upfloor;</p>
<p>downfloor=key;</p>
<p>}</p>
<p>if(EleOneState==0)</p>
<p>{</p>
<p>callfloor=key;</p>
<p>if(EleOne&gt;1) downfloor=key;</p>
<p>else upfloor=key;</p>
<p>}</p>
<p>if(EleOneState==2)</p>
<p>{</p>
<p>downfloor = key &lt; downfloor ? key: downfloor;</p>
<p>upfloor=key;</p>
<p>}</p>
<p>}</p>
<p>else if(key&gt;=8 &amp;&amp; key&lt;=11)</p>
<p>{</p>
<p>key=key-7;</p>
<p>if(EleOneState==1)</p>
<p>{</p>
<p>upfloor = key &gt; upfloor ? key:upfloor;</p>
<p>downfloor=key;</p>
<p>}</p>
<p>if(EleOneState==0)</p>
<p>{ if( EleTwoState==0 &amp;&amp; abs(EleOne-key)&gt;abs(EleTwo-key))</p>
<p>{</p>
<p>callfloor2=key;</p>
<p>if(EleTwo&gt;1) downfloor2=key;</p>
<p>else upfloor2=key;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>callfloor=key;</p>
<p>if(EleOne&gt;1) downfloor=key;</p>
<p>else upfloor=key;</p>
<p>}</p>
<p>}</p>
<p>if(EleOneState==2)</p>
<p>{</p>
<p>downfloor = key &lt; downfloor ? key: downfloor;</p>
<p>upfloor=key;</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>/*数据处理函数*/</p>
<p>void dataProcess(){</p>
<p>uchar i, j, k = 1; // k标记当前处理的数据位(跳过第0位引导码)</p>
<p>uchar value; // 存放处理后的键值</p>
<p>for(i = 0; i &lt; 4; i++){ // 一帧数据(4个字节)</p>
<p>value = 0;</p>
<p>for(j = 0; j &lt; 8; j++){ // 每个字节8位</p>
<p>if(dat[k++] &gt; 7){ // 当前数据为1</p>
<p>/*TC9012遥控器定义&#39;0&#39;的两个下降沿时间间隔为1.125ms;<br>&#39;1&#39;的两个下降沿时间间隔为2.25ms;</p>
<p>所以接收端检测到的时间间隔[time * T(系统)]的平均值 = (1.125 + 2.25) /<br>2 = 1.6875ms;</p>
<p>假定系统晶振为11.0592MHz, 则T(系统) = 1.0850694us; 8位定时器每次定时长度<br>= 256 * T(系统) = 0.277ms;</p>
<p>1.6875 / 0.277 = 6.0921(次); 所以,<br>若定时次数大于7次，即平均时间间隔大于1.6875ms, 可判定该数据为1;</p>
<p>否则为0。</p>
<p>*/</p>
<p>value |= 0x80; // 最高位置1</p>
<p>}</p>
<p>if(j &lt; 7){</p>
<p>value &gt;&gt;= 1; //<br>因为TC9012遥控器发送的数据低位在前，高位在后，故需做右移位处理</p>
<p>}</p>
<p>}</p>
<p>finalData[i] = value;</p>
<p>}</p>
<p>processFlag = 1; // 一帧数据处理完</p>
<p>}</p>
<p>/*键值处理函数*/</p>
<p>void keyValueProcess(){</p>
<p>switch(finalData[2]){</p>
<p>/*特殊功能键(11个)*/</p>
<p>case 0x45: key=7;keyVauleFlag=1;break; //ch-</p>
<p>case 0x46: key=8;keyVauleFlag=1;break; //ch</p>
<p>case 0x47: key=9;keyVauleFlag=1;break; //ch</p>
<p>case 0x44: key=10;keyVauleFlag=1;break;</p>
<p>case 0x40: key=11;keyVauleFlag=1;break;</p>
<p>case 0x43: key=12;keyVauleFlag=1;break;</p>
<p>case 0x07: key=13;keyVauleFlag=1;break;</p>
<p>case 0x15: key=14;keyVauleFlag=1;break;</p>
<p>case 0x09: key=15;keyVauleFlag=1;break;</p>
<p>case 0x19: break;</p>
<p>case 0x0d: break;</p>
<p>/*数字键(0~9共10个)*/</p>
<p>case 0x16: disValue = 0;keyFlag = 1; break; // 显示按键值0, 开蜂鸣器</p>
<p>case 0x0c: disValue = 1;keyFlag = 1; break; // 显示按键值1, 关蜂鸣器</p>
<p>case 0x18: disValue = 2;keyFlag = 1; break; // 显示按键值2, 开LED</p>
<p>case 0x5e: disValue = 3;keyFlag = 1; break; // 显示按键值3, 关LED</p>
<p>case 0x08: disValue = 4;keyFlag = 1; break;</p>
<p>case 0x1c: disValue = 5;keyFlag = 1; break;</p>
<p>case 0x5a: disValue = 6;keyFlag = 1; break;</p>
<p>case 0x42: disValue = 7;keyFlag = 1; break;</p>
<p>case 0x52: disValue = 8;keyFlag = 1; break;</p>
<p>case 0x4a: disValue = 9;LCD=1; break; // 9</p>
<p>default: break;</p>
<p>}</p>
<p>}</p>
<p>void keyProcess2()</p>
<p>{</p>
<p>if(disValue&gt;=1 &amp;&amp; disValue&lt;=4 )</p>
<p>{</p>
<p>if(EleTwoState==1)</p>
<p>{</p>
<p>upfloor2 = disValue &gt; upfloor2 ? disValue:upfloor2;</p>
<p>downfloor2=disValue;</p>
<p>}</p>
<p>if(EleTwoState==0)</p>
<p>{</p>
<p>if( EleTwoState==0 &amp;&amp; abs(EleOne-disValue)&lt;abs(EleTwo-disValue))</p>
<p>{</p>
<p>callfloor=disValue;</p>
<p>if(EleOne&gt;1) downfloor=disValue;</p>
<p>else upfloor=disValue;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>callfloor2=disValue;</p>
<p>if(EleTwo&gt;1) downfloor2=disValue;</p>
<p>else upfloor2=disValue;</p>
<p>}</p>
<p>}</p>
<p>if(EleTwoState==2)</p>
<p>{</p>
<p>downfloor2 = disValue &lt; downfloor2 ? disValue: downfloor2;</p>
<p>upfloor2=key;</p>
<p>}</p>
<p>}</p>
<p>else if(disValue&lt;=8 &amp;&amp; disValue&gt;=5)</p>
<p>{</p>
<p>disValue=disValue-4;</p>
<p>if(EleTwoState==1)</p>
<p>{</p>
<p>upfloor2 = disValue &gt; upfloor2 ? disValue:upfloor2;</p>
<p>downfloor2=disValue;</p>
<p>}</p>
<p>if(EleTwoState==0)</p>
<p>{</p>
<p>callfloor2=disValue;</p>
<p>if(EleTwo&gt;1) downfloor2=disValue;</p>
<p>else upfloor2=disValue;</p>
<p>}</p>
<p>if(EleTwoState==2)</p>
<p>{</p>
<p>downfloor2 = disValue &lt; downfloor2 ? disValue: downfloor2;</p>
<p>upfloor2=disValue;</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>Display.c</p>
<p>#include &quot;InfraredControl2.h&quot;</p>
<p>uchar code table0[] = {&quot;Elevator 1:&quot;};</p>
<p>uchar code table1[] = {&quot;Elevator 2:&quot;};</p>
<p>uchar code table2[] = {&quot;0123456789&quot;};</p>
<p>uchar num = 0;</p>
<p>uchar state=0;</p>
<p>/*延时xms函数*/</p>
<p>void delayxms(uint xms){</p>
<p>uint i, j;</p>
<p>for(i = xms; i &gt; 0; i--)</p>
<p>for(j = 110; j &gt; 0; j--);</p>
<p>}</p>
<p>/*初始化LCD1602的设置*/</p>
<p>void LCDInit(){</p>
<p>lcden = 0; // 拉低使能端，准备产生使能高脉冲信号</p>
<p>writeCommand(0x38); // 显示模式设置(16x2， 5x7点阵，8位数据接口)</p>
<p>writeCommand(0x0c); // 开显示，不显示光标</p>
<p>writeCommand(0x06); // 写一个字符后地址指针自动加1</p>
<p>writeCommand(0x01); // 显示清零，数据指针清零</p>
<p>displayMain();</p>
<p>}</p>
<p>/*LCD显示函数*/</p>
<p>void display(){</p>
<p>writeCommand(0x80 + strlen(table0)+1); //指针定位</p>
<p>writeDataLCD(table2[EleOne]);</p>
<p>delayxms(5);</p>
<p>if(EleOneState==0)state=0x50;</p>
<p>if(EleOneState==1)state=0x5e;</p>
<p>if(EleOneState==2)state=0x76;</p>
<p>writeCommand(0x80 + strlen(table0)+3); //指针定位</p>
<p>writeDataLCD(state);</p>
<p>delayxms(5);</p>
<p>writeCommand(0x80 + 0x40+ strlen(table1)+1); //指针定位</p>
<p>writeDataLCD(table2[EleTwo]);</p>
<p>delayxms(5);</p>
<p>if(EleTwoState==0)state=0x50;</p>
<p>if(EleTwoState==1)state=0x5e;</p>
<p>if(EleTwoState==2)state=0x76;</p>
<p>writeCommand(0x80 + 0x40+ strlen(table1)+3); //指针定位</p>
<p>writeDataLCD(state);</p>
<p>delayxms(5);</p>
<p>}</p>
<p>/*写指令函数*/</p>
<p>void writeCommand(uchar command ){</p>
<p>lcdrs = 0; // 命令选择</p>
<p>lcdrw = 0;</p>
<p>P0 = command;</p>
<p>delayxms(5);</p>
<p>lcden = 1; // 产生一个正脉冲使能信号</p>
<p>delayxms(5);</p>
<p>lcden = 0;</p>
<p>}</p>
<p>/*写数据函数*/</p>
<p>void writeDataLCD(uchar dat){</p>
<p>lcdrs = 1; // 数据选择</p>
<p>lcdrw = 0;</p>
<p>P0 = dat;</p>
<p>delayxms(5);</p>
<p>lcden = 1;</p>
<p>delayxms(5);</p>
<p>lcden = 0;</p>
<p>}</p>
<p>/*密码正确进入选择界面*/</p>
<p>void displayMain()</p>
<p>{</p>
<p>uchar i;</p>
<p>writeCommand(0x01);</p>
<p>writeCommand(0x80); // 将数据指针定位到第一行首</p>
<p>for(i = 0; i &lt; strlen(table0); i++){</p>
<p>writeDataLCD(table0[i]);</p>
<p>delayxms(5);</p>
<p>}</p>
<p>writeCommand(0x80 + 0x40); // 将数据指针定位到第二行首</p>
<p>for(i = 0; i &lt; strlen(table1); i++){</p>
<p>writeDataLCD(table1[i]);</p>
<p>delayxms(5);</p>
<p>}</p>
<p>}</p>
<p>/*-----------------------------------------------</p>
<p>名称：四相五线减速步进电机</p>
<p>日期：2009.5</p>
<p>修改：无</p>
<p>内容：1、本程序用于测试4相步进电机常规驱动</p>
<p>2、需要用跳帽或者杜邦线把信号输出端和对应的步进电机信号输入端连接起来</p>
<p>3、速度不可以调节的过快，不然就没有力矩转动了</p>
<p>------------------------------------------------*/</p>
<p>#include &quot;InfraredControl2.h&quot;</p>
<p>#include &lt;reg52.h&gt;</p>
<p>sbit DULA=P2^6;//数码管段选锁存器信号</p>
<p>unsigned char code F_Rotation[4]={0x0f,0x8f,0x4f,0x2f};<br>//正转表格，换算成二进制 0001 0000，0000 1000，0000 0100，0000 0010</p>
<p>unsigned char code B_Rotation[4]={0x2f,0x4f,0x8f,0x0f};<br>//反转表格，换算成二进制 0000 0010，0000 0100，0000 1000，0001 0000</p>
<p>/******************************************************************/</p>
<p>/* 延时函数 */</p>
<p>/******************************************************************/</p>
<p>void Delay2(unsigned int i)//延时</p>
<p>{</p>
<p>while(--i);</p>
<p>}</p>
<p>void zhenzhuan()</p>
<p>{ unsigned char i,j;</p>
<p>j=1000;</p>
<p>P0=0X00;</p>
<p>Delay2(500);</p>
<p>DULA=1;</p>
<p>Delay2(500);</p>
<p>DULA=0;</p>
<p>while(j){</p>
<p>for(i=0;i&lt;4;i++) //4相</p>
<p>{</p>
<p>P2=F_Rotation[i]; //输出对应的相 可以自行换成反转表格</p>
<p>Delay2(300); //改变这个参数可以调整电机转速 ,数字越小，转速越大</p>
<p>}</p>
<p>j--;</p>
<p>}</p>
<p>time1=0;</p>
<p>}</p>
<p>void fanzhuan()</p>
<p>{ unsigned char i,j;</p>
<p>j=1000;</p>
<p>P0=0X00;</p>
<p>Delay2(500);</p>
<p>DULA=1;</p>
<p>Delay2(500);</p>
<p>DULA=0;</p>
<p>while(j){</p>
<p>for(i=0;i&lt;4;i++) //4相</p>
<p>{</p>
<p>P2=B_Rotation[i]; //输出对应的相 可以自行换成反转表格</p>
<p>Delay2(300); //改变这个参数可以调整电机转速 ,数字越小，转速越大</p>
<p>}</p>
<p>j--;</p>
<p>}</p>
<p>time1=0;</p>
<p>}</p>
<p>#include &lt;reg52.h&gt;</p>
<p>#include &lt;string.h&gt;</p>
<p>#include &lt;stdio.h&gt;</p>
<p>#include &lt;intrins.h&gt;</p>
<p>#define uchar unsigned char</p>
<p>#define uint unsigned int</p>
<p>#define DATALEN 33 // 数据帧长度(1bit引导码 + 32bit数据)</p>
<p>sbit buzzer = P2^3;</p>
<p>sbit dula=P2^6; //段选信号的锁存器控制</p>
<p>sbit wela=P2^7; //位选信号的锁存器控制</p>
<p>extern uchar EleOneState;</p>
<p>extern uchar EleTwoState;</p>
<p>extern uchar EleOne;</p>
<p>extern uchar EleTwo;</p>
<p>extern uchar time1;</p>
<p>/*LCD1602显示模块端口定义*/</p>
<p>sbit lcdrs = P3^5;</p>
<p>sbit lcdrw = P3^6;</p>
<p>sbit lcden = P3^4;</p>
<p>void writeCommand(uchar command ) ;</p>
<p>void writeDataLCD(uchar dat);</p>
<p>void LCDInit();</p>
<p>void display();</p>
<p>void displayMain();</p>
<p>void delay(unsigned char i);</p>
<p>//主函数模块函数声明</p>
<p>void ecternINT0Init();</p>
<p>//电梯调度</p>
<p>int downFloor(uchar *x,uchar *y);</p>
<p>void LookAlgorithm();</p>
<p>void keyProcess();</p>
<p>void keyProcess2();</p>
<p>//数码管显示函数声明</p>
<p>void delayxms(uint xms);</p>
<p>void display();</p>
<p>//矩阵键盘检测</p>
<p>void get_key_vaule();</p>
<p>/*红外接收模块端口定义*/</p>
<p>sbit infraredReceiver = P3^2;</p>
<p>void keyValueProcess();</p>
<p>void dataProcess();</p>
<p>void fanzhuan();</p>
<p>void zhenzhuan();</p>
<p>附3、使用说明书</p>
<ol>
<li><p> 上电初始化。</p>
</li>
<li><p> 按下复位键、程序复位。</p>
</li>
<li><p> 红外遥控上1-4表示轿外呼叫，分别代表1到4楼。</p>
</li>
<li><p> 5-8表示轿内呼叫，也分别代表1到4楼。</p>
</li>
<li><p> 在电梯外面时，只要按下1-4对应按键，电梯就会来到这一层。然后在电梯里选择要去的楼层。</p>
</li>
<li><p> 按键9表示电梯故障、按下以后LED闪烁、蜂鸣器发出警报，此时代表电梯故障不能使用。</p>
</li>
</ol>

    </div>

    
    
    
        <div class="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Chen Yin 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Chen Yin 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA-C-%E7%94%B5%E6%A2%AF%E6%8E%A7%E5%88%B6/" rel="tag"># 单片机 C 电梯控制</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/07/25/shen-du-xue-xi-huan-jing-da-jian/" rel="prev" title="深度学习环境搭建">
      <i class="fa fa-chevron-left"></i> 深度学习环境搭建
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E8%AE%BE%E8%AE%A1%E7%9B%AE%E7%9A%84"><span class="nav-number">1.</span> <span class="nav-text">1、设计目的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E8%AE%BE%E8%AE%A1%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.</span> <span class="nav-text">2、设计任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E5%8E%9F%E7%90%86%E6%A1%86%E5%9B%BE%E5%8F%8A%E8%AF%B4%E6%98%8E"><span class="nav-number">3.</span> <span class="nav-text">3、原理框图及说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E4%B8%BB%E8%A6%81%E7%94%B5%E8%B7%AF%E8%AF%B4%E6%98%8E%E3%80%81%E5%85%83%E4%BB%B6%E9%80%89%E6%8B%A9%E5%8F%8A%E5%8F%82%E6%95%B0%E8%AE%A1%E7%AE%97"><span class="nav-number">4.</span> <span class="nav-text">4、主要电路说明、元件选择及参数计算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%8D%95%E7%89%87%E6%9C%BA%E6%9C%80%E5%B0%8F%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 单片机最小系统模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%E6%8C%89%E9%94%AE%E7%94%B5%E8%B7%AF"><span class="nav-number">4.2.</span> <span class="nav-text">4.2按键电路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E7%94%B5%E6%9C%BA%E9%A9%B1%E5%8A%A8%E7%94%B5%E8%B7%AF"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 电机驱动电路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E6%98%BE%E7%A4%BA%E6%A8%A1%E5%9D%97"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 显示模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-%E6%8A%A5%E8%AD%A6%E6%A8%A1%E5%9D%97"><span class="nav-number">4.5.</span> <span class="nav-text">4.5 报警模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81%E6%80%BB%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="nav-number">5.</span> <span class="nav-text">5、总电路设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6%E3%80%81%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%A1%86%E5%9B%BE"><span class="nav-number">6.</span> <span class="nav-text">6、软件设计思路及框图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF%E5%8F%8A%E4%B8%BB%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">6.1.</span> <span class="nav-text">6.1软件设计思路及主流程图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2%E5%8F%82%E6%95%B0%E8%AE%A1%E7%AE%97"><span class="nav-number">6.2.</span> <span class="nav-text">6.2参数计算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7%E3%80%81%E7%BB%93%E6%9E%9C%E5%8F%8A%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90"><span class="nav-number">7.</span> <span class="nav-text">7、结果及测试分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1%E7%A1%AC%E4%BB%B6%E7%94%B5%E8%B7%AF"><span class="nav-number">7.1.</span> <span class="nav-text">7.1硬件电路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2%E6%B5%8B%E8%AF%95%E8%AE%B0%E5%BD%95%E5%8F%8A%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90"><span class="nav-number">7.2.</span> <span class="nav-text">7.2测试记录及结果分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8%E3%80%81%E4%BD%93%E4%BC%9A%E4%B8%8E%E6%84%9F%E6%83%B3"><span class="nav-number">8.</span> <span class="nav-text">8、体会与感想</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Chen Yin"
      src="/images/R.png">
  <p class="site-author-name" itemprop="name">Chen Yin</p>
  <div class="site-description" itemprop="description">卑鄙是卑鄙者的通行证，高尚是高尚者的墓志铭</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/cyinen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cyinen"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chenyin1050@gmail.com" title="E-Mail → mailto:chenyin1050@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chen Yin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  















  

  

</body>
</html>
